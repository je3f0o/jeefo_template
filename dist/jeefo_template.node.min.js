/**
 * jeefo_template : v0.0.9
 * Author         : je3f0o, <je3f0o@gmail.com>
 * Homepage       : https://github.com/je3f0o/jeefo_template
 * License        : The MIT License
 * Copyright      : 2017
 **/
"use strict";module.exports=function(e){return e.use(function(e){var t=e.module("jeefo_template",["jeefo_tokenizer"]);t.namespace("jeefo_template.tokenizer",["tokenizer.Tokenizer"],function(e){var t=new e,s=function(e){return{line:e.line,index:e.index+1,column:e.column+1,virtual_column:e.virtual_column+1}};return t.register({is:function(e){switch(e){case">":case"+":case"^":return!0}},protos:{type:"Operator",precedence:1,end_cursor:s,initialize:function(e,t){this.type=this.type,this.operator=e,this.start=t.get_cursor(),this.end=this.end_cursor(this.start)}}}).register({is:function(e){return"{"===e},protos:{type:"Comment",precedence:1,end_cursor:s,initialize:function(e,t){this.type=this.type;var s,r,n=t.get_cursor();for(e=t.next(!0),s=t.cursor.index;e&&"}"!==e;)r=t.cursor.index,e=t.next(!0);this.comment=t.seek(s,r+1),this.start=n,this.end=this.end_cursor(t.get_cursor())}}}).register({protos:{type:"Element",delimiters:".,>+^[]()=\"'#{}",end_cursor:s,initialize:function(e,t){var s,r,n=t.get_cursor();switch(this.type=this.type,e){case".":case"#":case"[":case"(":case"+":case">":case"^":this.name=null;break;default:this.name=this.parse_identifier(t),s=t.get_cursor(),e=t.next(!0)}this.class_list=[];e:for(;;)switch(e){case".":t.next(!0),r=this.parse_identifier(t),-1===this.class_list.indexOf(r)&&this.class_list.push(r),s=t.get_cursor(),e=t.next(!0);break;case"#":this.id=this.parse_identifier(t),s=t.get_cursor(),e=t.next(!0);break;default:break e}"["===e&&(this.parse_attrs(t),s=t.get_cursor(),e=t.next(!0)),e&&"("===e&&(this.parse_content(t),s=t.get_cursor()),this.start=n,this.end=this.end_cursor(s),t.cursor=s},parse_identifier:function(e){for(var t,s=e.current(),r=e.cursor.index;s&&s>" "&&-1===this.delimiters.indexOf(s);)t=e.get_cursor(),s=e.next();return e.cursor=t,e.seek(r,t.index+1)},parse_content:function(e){var t=e.next();'"'!==t&&"'"!==t||(this.content=this.parse_value(e),e.next(!0))},parse_value:function(e){for(var t=e.current(),s=e.next(),r=e.cursor.index;s&&s!==t;s=e.next())"\\"===s&&e.next();return e.seek(r)},parse_attrs:function(e){for(var t,s,r=this.attrs={},n=e.next(!0);n&&"]"!==n;){for(t=this.parse_identifier(e),n=e.next(!0),"="===n?(e.next(!0),s=this.parse_value(e),n=e.next(!0)):s=null;","===n;)n=e.next(!0);r[t]=s}}}}),t}),t.namespace("jeefo_template.attrs",["is_array","object.keys","transform.dash_case"],function(e,t,s){var r=function(){},n=r.prototype;return n.is_array=e,n.dash_case=s,n.object_keys=t,n.NEW_LINE_REGEX=/\n/g,n.SINGLE_QUOTE_REGEX=/'/g,n.stringify=function(e){for(var t="",s=this.object_keys(e),r=0,n=s.length;r<n;++r)if(void 0!==e[s[r]]&&"function"!==typeof e[s[r]])switch(r>0&&(t+=", "),typeof e[s[r]]){case"string":t+="'"+s[r]+"':'"+e[s[r]].replace(this.SINGLE_QUOTE_REGEX,"\\'")+"'";break;case"object":null===e[s[r]]?t+="'"+s[r]+"':null":e[s[r]].toString&&("[object Object]"===e[s[r]].toString()?t+="'"+s[r]+"':"+this.stringify(e[s[r]]):t+="'"+s[r]+"':'"+e[s[r]].toString()+"'");break;case"number":case"boolean":t+="'"+s[r]+"':"+e[s[r]].toString()}return"{ "+t+" }"},n.get_value=function(e){return e.trim().replace(this.NEW_LINE_REGEX," ")},n.compile=function(s){if(!s)return"";var r,n,i="",a=0;for(s.hasOwnProperty("id")&&(i+=' id="'+this.get_value(s.id)+'"',delete s.id),s.hasOwnProperty("_class")&&(e(s._class)&&(s._class=s._class.join(" ")),s.hasOwnProperty("class")?s.class=s._class+" "+s.class:s.class=s._class,delete s._class),s.hasOwnProperty("class")&&(i+=' class="'+this.get_value(s.class)+'"',delete s.class),n=t(s),r=n.length;a<r;++a)switch(typeof s[n[a]]){case"object":null===s[n[a]]?i+=" "+this.dash_case(n[a]):i+=" "+this.dash_case(n[a])+'="'+this.stringify(s[n[a]])+'"';break;case"string":i+=" "+this.dash_case(n[a])+'="'+this.get_value(s[n[a]])+'"';break;case"undefined":i+=" "+this.dash_case(n[a]);break;default:i+=" "+this.dash_case(n[a])+'="'+s[n[a]].toString()+'"'}return i},new r}),t.namespace("jeefo_template.compiler",["is_array","transform.dash_case","jeefo_template.attrs","jeefo_template.tokenizer"],function(e,t,s,r){var n=function(){};n.prototype={is_array:e,dash_case:t,SPACE_REGEX:/\s+/,NodeElement:function(e,s){if(this.name=e.name?t(e.name):"div",this.parent=s,this.children=[],e.attrs&&(this.attrs=e.attrs),e.content&&(this.content=e.content),e.id&&(this.attrs?this.attrs.id||(this.attrs.id=e.id):this.attrs={id:this.id}),e.class_list&&e.class_list.length)if(this.attrs){if(this.attrs._class){var r;r=this.is_array(this.attrs._class)?this.attrs._class:this.attrs._class.split(this.SPACE_REGEX);for(var n=r.length-1;n>=0;--n)r[n]&&-1===e.class_list.indexOf(r[n])&&e.class_list.push(r[n])}this.attrs._class=e.class_list}else this.attrs={_class:e.class_list}},SELF_CLOSED_TAGS:["img","input","hr","br","col"],make_nodes:function(e){for(var t,s,r=this.NodeElement,n=new r({}),i=e.next(),a=n;i;i=e.next()){switch(i.type){case"Element":t=new r(i,a),a.children[a.children.length]=t;break;case"Operator":switch(i.operator){case"+":switch(">"===s.operator&&(t=new r({},a),a.children[a.children.length]=t),s.operator){case"+":case">":t=new r({},a),a.children[a.children.length]=t,i.compiled=!0}break;case">":switch(s.operator){case"+":case">":t=new r({},a),a.children[a.children.length]=t,a=t;break;default:a=a.children[a.children.length-1]}break;case"^":if(">"===s.operator&&(t=new r({},a),a.children[a.children.length]=t),!a.parent)throw new Error("No parent element");a=a.parent;break;default:throw console.log("Invalid Operator"),i}}s=i}switch(s.operator){case"+":case">":s.compiled||(t=new r({},a),a.children[a.children.length]=t)}return n.children},compile_beauty:function(e,t,r){for(var n=0,i=e.length,a="",c=this.SELF_CLOSED_TAGS;n<i;++n)n>0&&(a+="\n"),c.indexOf(e[n].name)>-1?a+=t+"<"+e[n].name+s.compile(e[n].attrs)+">":e[n].children.length?a+=t+"<"+e[n].name+s.compile(e[n].attrs)+">\n"+this.compile_beauty(e[n].children,t+r,r)+"\n"+t+"</"+e[n].name+">":e[n].content?a+=t+"<"+e[n].name+s.compile(e[n].attrs)+">"+e[n].content+"</"+e[n].name+">":a+=t+"<"+e[n].name+s.compile(e[n].attrs)+"></"+e[n].name+">";return a},compile_ugly:function(e){for(var t=0,r=e.length,n="",i=this.SELF_CLOSED_TAGS;t<r;++t)i.indexOf(e[t].name)>-1?n+="<"+e[t].name+s.compile(e[t].attrs)+">":e[t].children.length?n+="<"+e[t].name+s.compile(e[t].attrs)+">"+this.compile_ugly(e[t].children)+"</"+e[t].name+">":e[t].content?n+="<"+e[t].name+s.compile(e[t].attrs)+">"+e[t].content+"</"+e[t].name+">":n+="<"+e[t].name+s.compile(e[t].attrs)+"></"+e[t].name+">";return n}};var i=new n;return function(e,t,s,n){r.init(e,s);var a=i.make_nodes(r);if(t){s=s||4,n="tab"===n?"\n":" ";for(var c=0,o="";c<s;++c)o+=n;return i.compile_beauty(a,"",o)}return i.compile_ugly(a)}})}),e};